{
  "hash": "2168bf7210a8668314e3dfc23462499b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Hanukkah of Data 5783\"\nsubtitle: \"Solving the data version of Advent of Code in R\"\ndescription: \"Step-by-step R solutions to all 8 Hanukkah of Data puzzles - a data-focused alternative to Advent of Code with a delightful narrative twist.\"\nauthor: \"Guy Freeman\"\ndate: 2022-12-25\ncategories: [data, analysis, fun]\nimage: og-image.png\nexecute:\n  eval: true\n  echo: true\n  message: false\n  warning: false\n---\n\nThe creators of [VisiData](https://visidata.org), the retro-chic terminal-based data analysis tool, have built something wonderful: a data-focused alternative to Advent of Code. Instead of optimizing algorithms, you're exploring datasets. Instead of Christmas elves, you're helping Sarah find her grandmother's rug.\n\n[Hanukkah of Data](https://hanukkah.bluebird.sh/5783/) presents eight puzzles released over the eight nights of Hanukkah. Each puzzle gives you a narrative clue and asks you to find someone's phone number in a dataset from \"Noah's Market\" - a fictional New York grocery store. The puzzles chain together beautifully: each person you find leads you to the next.\n\nI discovered this challenge late and binged through the first seven puzzles in one sitting, then had to wait for the finale. Here's how I solved all eight puzzles in R.\n\n## The Data\n\nNoah's Market has provided us with four CSV files on a password-protected USB drive (the password is the year of the previous Hanukkah of Data - a nice meta-puzzle):\n\n- **customers**: Customer names, addresses, phone numbers, and birthdates\n- **orders**: Order timestamps and shipping info\n- **orders_items**: Line items linking orders to products\n- **products**: Product details including SKUs, descriptions, and pricing\n\nLet's load everything and create a denormalized view that joins orders with their items, products, and customers. This `orders_plus` table will be our workhorse for most puzzles.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse, warn.conflicts = FALSE)\nlibrary(lubridate, warn.conflicts = FALSE)\n\n# Download and extract the data\ndownload.file(\n  url = \"https://hanukkah.bluebird.sh/5783/noahs-csv.zip\",\n  destfile = \"noahs-csv.zip\"\n)\nsystem(\"unzip -P 5777 -o noahs-csv.zip\")\n\n# Load the four tables\ncustomers <- read_csv(\"noahs-customers.csv\")\norders <- read_csv(\"noahs-orders.csv\")\nitems <- read_csv(\"noahs-orders_items.csv\")\nproducts <- read_csv(\"noahs-products.csv\")\n\n# Create a denormalized view for analysis\norders_plus <- orders |>\n  inner_join(items, by = \"orderid\") |>\n  inner_join(products, by = \"sku\") |>\n  inner_join(customers, by = \"customerid\")\n```\n:::\n\n\n## Puzzle 1: The Private Investigator\n\nSarah needs help finding her grandmother's rug, and a cashier remembers a private investigator who once shopped at Noah's. The investigator's business card was clever: their phone number spelled out their last name using the old T9 phone keypad mapping (2=ABC, 3=DEF, etc.).\n\n**The challenge**: Find a customer whose phone number, when decoded, matches their last name.\n\nThis requires building a letter-to-number converter. The tricky part is that the phone keypad isn't perfectly regular - the letters S, V, Y, and Z are \"pushed\" to share keys with fewer letters, so they need special handling.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert a single letter to its T9 phone number\nletter_to_phone_digit <- function(letter) {\n  letter_index <- which(letters == letter)\n  digit <- floor(((letter_index - 1) / 3) + 2)\n  # Handle irregular keys: S(7), V(8), Y(9), Z(9)\n  if (letter %in% c(\"s\", \"v\", \"y\", \"z\")) {\n    return(as.character(digit - 1))\n  }\n  return(as.character(digit))\n}\n\n# Convert a full name to its phone number equivalent\nname_to_phone <- function(name) {\n  # Extract last name, lowercase, remove non-letters\n  surname <- (strsplit(name, \" \") |> unlist())[-1]\n  surname_clean <- str_to_lower(surname) |> str_replace_all(\"[^a-z]\", \"\")\n  surname_short <- str_sub(surname_clean, end = 10)  # Phone numbers are 10 digits\n\n  surname_short |>\n    strsplit(\"\") |>\n    unlist() |>\n    map_chr(letter_to_phone_digit) |>\n    paste0(collapse = \"\")\n}\n\n# Find customers where phone matches name\ncustomers |>\n  mutate(\n    name_as_phone = map_chr(name, name_to_phone),\n    phone_digits = str_replace_all(phone, \"-\", \"\")\n  ) |>\n  filter(phone_digits == name_as_phone) |>\n  pull(phone)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"488-836-2374\"\n```\n\n\n:::\n:::\n\n\n## Puzzle 2: The Rug Contractor\n\nThe private investigator tells us Sarah's rug was cleaned by an outside contractor. The cleaning company's records show a claim ticket reading \"2017 spec JD\" - the year and the contractor's initials. These contractors would meet at Noah's to discuss jobs over coffee and bagels.\n\n**The challenge**: Find someone with initials \"JD\" who bought both coffee and bagels in 2017.\n\nWe need to find orders containing multiple items from the coffee and bagel SKUs, then filter to 2017 and check for matching initials.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Helper to extract initials from a name\nget_initials <- function(name) {\n  str_extract_all(name, \"[A-Z]\") |> unlist() |> paste0(collapse = \"\")\n}\n\n# Coffee and bagel SKUs (found by exploring the products table)\ncoffee_bagel_skus <- c(\"DLI1464\", \"BKY4234\", \"BKY5887\")\n\norders_plus |>\n  filter(sku %in% coffee_bagel_skus) |>\n  group_by(orderid) |>\n  filter(n() > 1) |>  # Must have bought multiple items\n  ungroup() |>\n  filter(year(shipped) == 2017) |>\n  mutate(initials = map_chr(name, get_initials)) |>\n  filter(initials == \"JD\") |>\n  pull(phone) |>\n  unique()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"212-771-8924\"\n```\n\n\n:::\n:::\n\n\n## Puzzle 3: The Spider Hat Guy\n\nThe contractor remembers giving the rug to someone they saw near the South Ozone Park subway station. The person wore a hat with a spider on it, and the contractor recalls they were an Aries born in the Year of the Dog.\n\n**The challenge**: Find a customer in South Ozone Park, born under Aries (March 21 - April 19) in a Year of the Dog (2006, 1994, 1982, 1970, 1958...).\n\nThis is pure demographic filtering. Years of the Dog repeat every 12 years.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndog_years <- c(2006, 1994, 1982, 1970, 1958, 1946, 1934)\n\ncustomers |>\n  filter(year(birthdate) %in% dog_years) |>\n  filter(month(birthdate) %in% c(3, 4)) |>  # March or April for Aries\n  filter(citystatezip == \"South Ozone Park, NY 11420\") |>\n  pull(phone)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"516-636-7397\"\n```\n\n\n:::\n:::\n\n\n## Puzzle 4: The Early Bird Baker\n\nOur spider-hat friend reveals they cleaned part of the rug, found a beautiful owl pattern, and hung it on their wall. Then they met someone on Tinder who fixed their bike at 5am and received the rug as payment. This person loved arriving at Noah's before dawn to get the first pastries out of the oven.\n\n**The challenge**: Find someone who ordered bakery items (BKY prefix) very early in the morning with same-day delivery.\n\nThe \"before dawn\" detail is key. We're looking for orders placed around 4-5am.\n\n\n::: {.cell}\n\n```{.r .cell-code}\norders_plus |>\n  filter(hour(ordered) == 4) |>        # 4am orders\n  filter(ordered == shipped) |>         # Same-day delivery (pickup)\n  filter(str_detect(sku, \"BKY\")) |>     # Bakery items\n  select(customerid, name, phone) |>\n  distinct()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 3\n  customerid name             phone       \n       <dbl> <chr>            <chr>       \n1       5105 Heather Brown    929-518-7269\n2       5375 Christina Booker 718-649-9036\n```\n\n\n:::\n:::\n\n\nLooking at the results, there's one customer who fits this pattern. (I originally called this variable `tinder_girl` but that's not particularly descriptive!)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncustomers |>\n  filter(customerid == 5375) |>\n  pull(phone)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"718-649-9036\"\n```\n\n\n:::\n:::\n\n\n## Puzzle 5: The Cat Lady from Queens\n\nThe early-bird baker gave away the rug on Freecycle to a woman from Queens Village. She wore a Noah's Market sweatshirt and had about ten elderly cats, all with cataracts. It was raining, and she spent twenty minutes carefully wrapping the rug in plastic.\n\n**The challenge**: Find a woman in Queens who has bought cat-related products.\n\nWe're looking for someone in Queens whose order history suggests cat ownership.\n\n\n::: {.cell}\n\n```{.r .cell-code}\norders_plus |>\n  filter(str_detect(citystatezip, \"Queens\")) |>\n  filter(str_detect(desc, \"Cat\")) |>\n  select(customerid, name, phone) |>\n  distinct()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 3\n  customerid name           phone       \n       <dbl> <chr>          <chr>       \n1       7675 Anita Koch     315-492-7411\n2       6560 Joseph Weaver  680-839-3746\n3      11780 Joshua White   914-632-0184\n4       3335 Jose Cook      516-745-9461\n5       5486 Sam House      607-836-2966\n6       6905 Justin Cochran 716-525-5173\n```\n\n\n:::\n:::\n\n\nOnly one female name in the results - that's our cat lady.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# First result is our match\norders_plus |>\n  filter(str_detect(citystatezip, \"Queens\")) |>\n  filter(str_detect(desc, \"Cat\")) |>\n  slice(1) |>\n  pull(phone)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"315-492-7411\"\n```\n\n\n:::\n:::\n\n\n## Puzzle 6: The Frugal Cousin\n\nThe cat lady gave the rug to her cousin who was moving into a new apartment with wood floors. This cousin is extremely frugal - she clips every coupon and shops every sale at Noah's.\n\n**The challenge**: Find someone who consistently buys items below their wholesale cost.\n\nNoah's data includes both `unit_price` (what the customer paid) and `wholesale_cost` (what Noah's paid). A truly frugal shopper would have many orders where they paid less than wholesale - taking advantage of deep discounts and coupons.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Find customers who frequently buy below wholesale\nloss_leaders <- orders_plus |>\n  filter(wholesale_cost > unit_price) |>\n  count(customerid, name, phone, sort = TRUE)\n\n# The top customer has far more loss-leader purchases than anyone else\nloss_leaders |> head(5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 4\n  customerid name              phone            n\n       <dbl> <chr>             <chr>        <int>\n1       8342 Emily Randolph    914-868-0316    26\n2       4308 Travis Bartlett   929-906-5980     8\n3       2956 Jonathan Williams 332-668-0158     6\n4       5788 Joshua Hansen     680-511-5677     6\n5       1422 Morgan Smith      585-689-9118     5\n```\n\n\n:::\n:::\n\n\nCustomer 8342 stands out dramatically - they're the frugal cousin.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncustomers |>\n  filter(customerid == 8342) |>\n  pull(phone)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"914-868-0316\"\n```\n\n\n:::\n:::\n\n\n## Puzzle 7: The Ex-Boyfriend\n\nThe frugal cousin tells a romantic story: she met a man at Noah's when he handed back something she'd dropped. They'd bought nearly identical items but preferred each other's color choices, so they swapped. They dated, she moved in, but it didn't work out. She left hastily one night, leaving the rug behind.\n\n**The challenge**: Find someone who bought the same product as the frugal cousin on the same day, but in a different color.\n\nThis is the trickiest puzzle. We need to find two orders on the same day for the same product (ignoring color variants) but with different specific colors.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Add date components and normalize product descriptions (remove color)\norders_with_dates <- orders_plus |>\n  mutate(\n    order_day = day(ordered),\n    order_month = month(ordered),\n    order_year = year(ordered),\n    product_base = str_replace(desc, \"\\\\([a-z]+\\\\)\", \"\") |> str_squish()\n  )\n\n# Get the frugal cousin's orders\ncousin_orders <- orders_with_dates |>\n  filter(customerid == 8342)\n\n# Find matching orders: same base product, same date, different color\nromantic_match <- cousin_orders |>\n  inner_join(\n    orders_with_dates,\n    by = c(\"product_base\", \"order_day\", \"order_month\", \"order_year\")\n  ) |>\n  filter(customerid.y != 8342) |>       # Not the cousin herself\n  filter(desc.x != desc.y) |>            # Different color variant\n  arrange(abs(ordered.x - ordered.y))    # Orders closest in time\n\nromantic_match |>\n  slice(1) |>\n  pull(phone.y)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"315-618-5263\"\n```\n\n\n:::\n:::\n\n\n## Puzzle 8: The Collector\n\nThe ex-boyfriend says a woman mysteriously appeared and then vanished from his life, leaving behind a rug depicting a snake hidden in branches. He gave it to his sister in Manhattan, who passed it to \"an acquaintance who collects all sorts of junk\" - specifically, someone who \"owns an entire set of Noah's collectibles.\"\n\n**The challenge**: Find someone who has bought a large number of Noah's-branded products.\n\nNoah's Market apparently sells branded collectibles. We need to find a customer who's accumulated an impressive collection.\n\n\n::: {.cell}\n\n```{.r .cell-code}\norders_plus |>\n  filter(str_detect(desc, \"^Noah\")) |>    # Products starting with \"Noah\"\n  group_by(customerid, name, phone) |>\n  summarise(noah_items = n(), .groups = \"drop\") |>\n  filter(noah_items > 200) |>              # Serious collector\n  pull(phone)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"929-906-5980\"\n```\n\n\n:::\n:::\n\n\n## The Finale\n\nEntering the final phone number reveals something spectacular - but I won't spoil it here. The Hanukkah of Data team has crafted something genuinely delightful.\n\nWhat I love about this challenge is how it mirrors real data analysis work. You have messy, interconnected datasets. You have vague requirements (\"find someone who shops the sales\"). You have to make assumptions, explore the data, and iterate. The puzzle designers cleverly embedded multiple valid approaches for most puzzles while ensuring each has a unique solution.\n\nIf you haven't tried it yet, [give it a go](https://hanukkah.bluebird.sh/5783/). And if you're looking for more years to solve, they've continued the tradition with new datasets and puzzles.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}